{
  "definitions": {
    "replicas": {
      "minimum": 1,
      "type": "integer",
      "description": "Number of replicas set if the horizontal pod autoscaler is disabled or malfunctioning"
    },
    "image": {
      "description": "Docker image configuration",
      "additionalProperties": false,
      "anyOf": [
        {
          "required": [
            "tag"
          ]
        },
        {
          "required": [
            "digest"
          ]
        }
      ],
      "required": [
        "repository",
        "pullPolicy"
      ],
      "type": "object",
      "properties": {
        "pullPolicy": {
          "enum": [
            "Always",
            "Never",
            "IfNotPresent"
          ],
          "type": "string",
          "description": "Pull policy of Docker image"
        },
        "tag": {
          "pattern": "^[0-9a-zA-Z._-]+$",
          "type": [
            "string",
            "null"
          ],
          "description": "Docker image tag",
          "minLength": 1,
          "maxLength": 256
        },
        "repository": {
          "minLength": 1,
          "type": "string",
          "description": "Docker repository",
          "maxLength": 256
        },
        "digest": {
          "pattern": "^sha256:[0-9a-f]{64}$",
          "type": [
            "string",
            "null"
          ],
          "description": "Docker image digest",
          "minLength": 71,
          "maxLength": 71
        }
      }
    },
    "strategy": {
      "description": "Update strategy",
      "$ref": "https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master/v1.12.8-standalone-strict/_definitions.json#/definitions/io.k8s.api.apps.v1.DeploymentStrategy"
    },
    "affinity": {
      "description": "Pod affinity and anti-affinity definitions",
      "$ref": "https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master/v1.12.8-standalone-strict/_definitions.json#/definitions/io.k8s.api.core.v1.Affinity"
    },
    "env": {
      "uniqueItems": true,
      "additionalItems": false,
      "description": "List of extra environment variables that may be specified in the container",
      "minItems": 0,
      "items": {
        "$ref": "https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master/v1.12.8-standalone-strict/_definitions.json#/definitions/io.k8s.api.core.v1.EnvVar"
      },
      "type": "array"
    },
    "revisionHistoryLimit": {
      "minimum": 0,
      "type": "integer",
      "description": "Number of old replica sets to store in case of the need to rollback"
    },
    "hpa": {
      "additionalProperties": false,
      "required": [
        "enabled",
        "minReplicas",
        "maxReplicas",
        "metrics"
      ],
      "type": "object",
      "description": "Horizontal pod autoscaler configuration",
      "properties": {
        "minReplicas": {
          "minimum": 1,
          "type": "integer",
          "description": "Minimum number of replicas"
        },
        "metrics": {
          "uniqueItems": true,
          "additionalItems": false,
          "description": "List of metrics to scale on",
          "minItems": 0,
          "items": {
            "$ref": "https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master/v1.12.8-standalone-strict/_definitions.json#/definitions/io.k8s.api.autoscaling.v2beta2.MetricSpec"
          },
          "type": "array"
        },
        "enabled": {
          "type": "boolean",
          "description": "Enable horizontal pod autoscaling"
        },
        "maxReplicas": {
          "minimum": 1,
          "type": "integer",
          "description": "Maximum number of replicas"
        }
      }
    },
    "resources": {
      "description": "Upper- and lower-bounded resource constraints of the containers",
      "$ref": "https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master/v1.12.8-standalone-strict/_definitions.json#/definitions/io.k8s.api.core.v1.ResourceRequirements"
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "agent-group chart configuration",
  "title": "Agent Group Chart Configuration",
  "additionalProperties": false,
  "required": [
    "image",
    "agent",
    "hpa",
    "replicas",
    "resources",
    "revisionHistoryLimit",
    "affinity",
    "env"
  ],
  "type": "object",
  "properties": {
    "replicas": {
      "description": "Number of replicas set if the horizontal pod autoscaler is disabled or malfunctioning",
      "$ref": "#/definitions/replicas"
    },
    "image": {
      "description": "Docker image configuration",
      "$ref": "#/definitions/image"
    },
    "agent": {
      "additionalProperties": false,
      "required": [
        "registerjson"
      ],
      "type": "object",
      "description": "Agent Group specific configuration",
      "properties": {
        "registerjson": {
          "oneOf": [
            {
              "additionalProperties": false,
              "type": "object"
            },
            {
              "additionalProperties": false,
              "required": [
                "cloudUrl",
                "username",
                "password",
                "agentGroupId"
              ],
              "type": "object",
              "properties": {
                "username": {
                  "type": "string",
                  "description": "Encrypted username of the Agent Installer user (encrypted using JitterbitUtils)"
                },
                "agentNamePrefix": {
                  "type": "string",
                  "description": "Prefix for each auto-registered agent's name"
                },
                "deregisterAgentOnDrainstop": {
                  "type": "boolean",
                  "description": "Performs agent deregistration on drainstop/JVM shutdown (defaults to false)"
                },
                "retryIntervalSeconds": {
                  "minimum": 5,
                  "type": "integer",
                  "description": "Number of seconds the agent will wait before retrying. This number doubles every retry to a maximum of 600 seconds (10 minutes). Defaults to 5, valid range 5-600.",
                  "maximum": 600
                },
                "agentGroupId": {
                  "type": "number",
                  "description": "Agent group ID from Management Console (hover over an agent group to see its ID)"
                },
                "retryCount": {
                  "minimum": 0,
                  "type": "integer",
                  "description": "Number of retries if agent is having issues making the call to Harmony cloud for registration (defaults to 10, valid range is 0-300)",
                  "maximum": 300
                },
                "password": {
                  "type": "string",
                  "description": "Encrypted password of the Agent Installer user (encrypted using JitterbitUtils)"
                },
                "cloudUrl": {
                  "type": "string",
                  "description": "Base URL of the Jitterbit Harmony Cloud"
                }
              }
            },
            {
              "type": "null"
            }
          ],
          "description": "agent group's register.json file"
        },
        "jitterbitconf": {
          "type": [
            "string",
            "null"
          ],
          "description": "Agent group's jitterbit.conf file"
        }
      }
    },
    "affinity": {
      "description": "Pod affinity and anti-affinity definitions",
      "$ref": "#/definitions/affinity"
    },
    "env": {
      "description": "List of additional environment variables that may be specified in the container",
      "$ref": "#/definitions/env"
    },
    "hpa": {
      "description": "Horizontal pod autoscaler configuration",
      "$ref": "#/definitions/hpa"
    },
    "revisionHistoryLimit": {
      "description": "Number of old replica sets to store in case of the need to rollback",
      "$ref": "#/definitions/revisionHistoryLimit"
    },
    "resources": {
      "description": "Upper- and lower-bounded resource constraints of the containers",
      "$ref": "#/definitions/resources"
    },
    "metadata": {
      "type": "object",
      "description": "Chart metadata"
    }
  }
}
